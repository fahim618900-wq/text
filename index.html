<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Live Code IDE</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- CodeMirror CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.65.14/lib/codemirror.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.65.14/theme/neo.css">

<!-- CodeMirror JS -->
<script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.14/lib/codemirror.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.14/mode/javascript/javascript.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.14/mode/htmlmixed/htmlmixed.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.14/mode/css/css.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.14/mode/python/python.js"></script>

<style>
body{
    margin:0;
    font-family:Arial,sans-serif;
    background:#f5f5f5;
    height:100vh;
    display:flex;
    flex-direction:column;
}

/* Header - চিকন করা হয়েছে */
header{
    height:40px; /* উচ্চতা কমিয়ে চিকন করা */
    display:flex;
    align-items:center;
    padding:0 8px;
    background:#f0f0f0; /* হালকা ব্যাকগ্রাউন্ড */
    border-bottom:1px solid #ddd;
    gap:4px;
}

.menu-btns{
    display:flex;
    gap:4px;
}

/* হালকা সোনালী রঙের বাটন */
button.action-btn{
    display:flex;
    align-items:center;
    gap:4px;
    padding:4px 8px;
    border:none;
    border-radius:3px;
    background:linear-gradient(135deg, #FFE066 0%, #FFD43B 100%); /* হালকা সোনালী গ্রেডিয়েন্ট */
    color:#333;
    font-weight:500;
    cursor:pointer;
    user-select:none;
    font-size:12px;
    height:28px; /* বাটনের উচ্চতা নির্দিষ্ট */
    transition:all 0.2s ease;
    box-shadow:0 1px 3px rgba(0,0,0,0.1);
}

button.action-btn:hover{
    background:linear-gradient(135deg, #FFD43B 0%, #FFC107 100%); /* হোভারে গাঢ় সোনালী */
    transform:translateY(-1px);
    box-shadow:0 2px 5px rgba(0,0,0,0.15);
}

button.action-btn:active{
    transform:translateY(0);
    box-shadow:0 1px 2px rgba(0,0,0,0.1);
}

button.action-btn span{
    user-select:none;
}

button.action-btn svg{
    width:16px;
    height:16px;
    fill:#333; /* আইকন কালো রঙ */
}

/* Editor */
#editor{
    flex:1;
    max-height:calc(100vh - 40px); /* হেডারের উচ্চতা বিবেচনা করে */
}

.CodeMirror{
    height:100%;
    font-size:14px;
    line-height:1.3; /* লাইন হাইট কমানো */
}

/* লাইন কাটা যাবে না */
.CodeMirror pre{
    margin:0;
    white-space: pre !important; /* লাইন ব্রেক না হওয়া */
    word-wrap: normal !important;
}

.CodeMirror-line {
    padding: 0 2px !important;
}

/* CodeMirror লাইন হাইট ঠিক করা */
.CodeMirror-line {
    line-height: 1.3 !important;
    min-height: 1.3em !important;
}

/* Fullscreen overlay */
#fullscreenOverlay{
    display:none;
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:#fff;
    z-index:9999;
}

#fullscreenOverlay iframe{
    width:100%;
    height:100%;
    border:none;
}

/* ডার্ক থিমের জন্য বাটন স্টাইল */
body.dark .action-btn{
    background:linear-gradient(135deg, #E6B400 0%, #CC9900 100%);
    color:#222;
}

body.dark .action-btn:hover{
    background:linear-gradient(135deg, #CC9900 0%, #B38600 100%);
}

body.dark .action-btn svg{
    fill:#222;
}
</style>
</head>
<body>

<header>
    <div class="menu-btns">
        <button class="action-btn" onclick="openFullScreen()">
            <svg viewBox="0 0 24 24"><path d="M4 4h6V2H2v8h2V4m14 0v6h2V2h-8v2h6m0 14h-6v2h8v-8h-2v6M4 14H2v8h8v-2H4v-6z"/></svg>
            <span>Full Screen</span>
        </button>
        <button class="action-btn" onclick="downloadCode()">
            <svg viewBox="0 0 24 24"><path d="M5 20h14v-2H5m7-14v8l3-3 1.41 1.41L12 18l-4.41-4.59L9 11l3 3V4h2z"/></svg>
            <span>Download</span>
        </button>
        <button class="action-btn" onclick="toggleTheme()">
            <svg viewBox="0 0 24 24"><path d="M12,3A9,9 0 0,0 3,12A9,9 0 0,0 12,21A9,9 0 0,0 12,3Z"/></svg>
            <span>Theme</span>
        </button>
    </div>
</header>

<textarea id="code"></textarea>
<div id="fullscreenOverlay"><iframe id="fullIframe"></iframe></div>

<script>
// Theme
if(localStorage.getItem("theme")==="dark") document.body.classList.add("dark");
function toggleTheme(){
    document.body.classList.toggle("dark");
    localStorage.setItem("theme", document.body.classList.contains("dark")?"dark":"light");
}

// CodeMirror setup
const editor = CodeMirror.fromTextArea(document.getElementById("code"), {
    mode: "htmlmixed",
    lineNumbers: true,
    theme: "neo",
    tabSize: 2,
    viewportMargin: Infinity,
    lineWrapping: false, /* লাইন কাটা বন্ধ */
    lineHeight: 1.3, /* লাইন হাইট নির্দিষ্ট */
    extraKeys: {
        "Enter": function(cm) {
            // ডাবল লাইন এড়ানোর জন্য কাস্টম Enter হ্যান্ডলার
            var cursor = cm.getCursor();
            var line = cm.getLine(cursor.line);
            
            // বর্তমান লাইনের শেষে যদি সেমিকোলন, ব্রেস ইত্যাদি থাকে
            if (line.trim().endsWith(';') || line.trim().endsWith('{') || line.trim().endsWith('}')) {
                cm.execCommand("newlineAndIndent");
                return;
            }
            
            // শুধু নতুন লাইন এবং ইন্ডেন্ট
            cm.replaceSelection("\n");
            cm.indentLine(cursor.line + 1);
        },
        "Backspace": "delCharBefore",
        "Shift-Enter": function(cm) {
            // Shift+Enter এ শুধু নতুন লাইন
            cm.replaceSelection("\n");
        }
    }
});

// Load saved code
editor.setValue(localStorage.getItem("savedCode")||"");

// Auto-save
editor.on("change", ()=>{
    localStorage.setItem("savedCode", editor.getValue());
});

// Download
function downloadCode(){
    const code = editor.getValue();
    const blob = new Blob([code], {type:"text/plain"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    const lang = detectLanguage(code);
    let ext = "txt";
    if(lang==="html") ext="html";
    if(lang==="css") ext="css";
    if(lang==="js") ext="js";
    if(lang==="python") ext="py";
    a.download = "code."+ext;
    a.click();
}

// Language detect
function detectLanguage(code){
    code = code.trim();
    if(code.includes("<") && code.includes(">")) return "html";
    if(code.includes("import") || code.includes("def") || code.includes("print")) return "python";
    if(code.includes("{") && code.includes("}") && code.includes(";")) return "js";
    if(code.includes("{") && code.includes("}") && !code.includes(";")) return "css";
    return "txt";
}

// Full Screen
function openFullScreen(){
    const overlay = document.getElementById("fullscreenOverlay");
    const iframe = document.getElementById("fullIframe");
    iframe.srcdoc = editor.getValue();
    overlay.style.display = "block";
}

// Close full screen on back button (mobile)
window.addEventListener('popstate', function(){
    const overlay = document.getElementById("fullscreenOverlay");
    if(overlay.style.display==="block"){
        overlay.style.display="none";
        history.pushState(null,null,location.href);
    }
});

// Push state
history.pushState(null,null,location.href);
</script>

</body>
</html>
