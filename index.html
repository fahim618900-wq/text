<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Live Code IDE</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Highlight.js for auto color -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

<style>
:root{
    --bg:#ffffff;
    --text:#000000;
    --header:#f5f5f5;
    --border:#dcdcdc;
}
body.dark{
    --bg:#0d0d0d;
    --text:#ffffff;
    --header:#1a1a1a;
    --border:#333333;
}

body{
    margin:0;
    background:var(--bg);
    color:var(--text);
    font-family:Arial, sans-serif;
    height:100vh;
    display:flex;
    flex-direction:column;
}

/* Header */
header{
    height:50px;
    background:var(--header);
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:0 10px;
    border-bottom:1px solid var(--border);
}

.left, .right{
    display:flex;
    align-items:center;
    gap:15px;
}

header svg{
    width:26px;
    height:26px;
    fill:var(--text);
    cursor:pointer;
}

/* Editor + Highlight Wrapper */
.editorWrapper {
    flex:1;
    display:flex;
    width:100%;
    position:relative;
}

#code {
    flex:1;
    width:100%;
    border:none;
    outline:none;
    font-size:15px;
    padding:10px;
    font-family:monospace;
    background:transparent;
    color:transparent;
    caret-color:var(--text);
    white-space:pre;
    overflow:auto;
    z-index:2; /* top layer */
    position:absolute;
}

/* Highlight layer */
#highlightBox {
    flex:1;
    padding:10px;
    font-size:15px;
    font-family:monospace;
    white-space:pre-wrap;
    word-wrap:break-word;
    overflow-y:auto;
    color:var(--text);
}

/* Read More */
.readmore-btn{
    background:var(--header);
    padding:6px 10px;
    border-radius:5px;
    display:inline-block;
    cursor:pointer;
    font-size:13px;
    border:1px solid var(--border);
    margin-top:5px;
}
</style>
</head>

<body>

<header>
    <div class="left">

        <!-- Menu -->
        <svg onclick="openMenu()" viewBox="0 0 24 24">
            <path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/>
        </svg>

        <!-- Full Screen -->
        <svg onclick="openFullScreen()" viewBox="0 0 24 24">
            <path d="M4 4h6V2H2v8h2V4m14 0v6h2V2h-8v2h6m0 14h-6v2h8v-8h-2v6M4 14H2v8h8v-2H4v-6z"/>
        </svg>

        <!-- Download -->
        <svg onclick="downloadCode()" viewBox="0 0 24 24">
            <path d="M5 20h14v-2H5m7-14v8l3-3 1.41 1.41L12 18l-4.41-4.59L9 11l3 3V4h2z"/>
        </svg>

    </div>

    <div class="right">
        <!-- Theme -->
        <svg onclick="toggleTheme()" viewBox="0 0 24 24">
            <path d="M12,3A9,9 0 0,0 3,12A9,9 0 0,0 12,21A9,9 0 0,0 12,3Z" />
        </svg>
    </div>
</header>


<!-- Editor + Highlight -->
<div class="editorWrapper">
    
    <pre><code id="highlightBox" class="language-html"></code></pre>

    <textarea id="code" placeholder="Write your code..."></textarea>

</div>

<iframe id="output"></iframe>

<script>
// LOAD THEME
if(localStorage.getItem("theme") === "dark"){
    document.body.classList.add("dark");
}

// Toggle Theme
function toggleTheme(){
    document.body.classList.toggle("dark");
    localStorage.setItem("theme",
        document.body.classList.contains("dark") ? "dark" : "light"
    );
}

/* ---------- AUTO SAVE + AUTO RUN ---------- */
const editor = document.getElementById("code");
const highlightBox = document.getElementById("highlightBox");
const output = document.getElementById("output");

editor.value = localStorage.getItem("savedCode") || "";
updateAll();

editor.addEventListener("input", ()=>{
    updateAll();
});

function updateAll(){
    const code = editor.value;

    // Save
    localStorage.setItem("savedCode", code);

    // Run
    output.srcdoc = code;

    // Highlight
    highlightBox.textContent = code;
    hljs.highlightElement(highlightBox);

    applyReadMore();
}

/* ---------- READ MORE SYSTEM ---------- */

function applyReadMore(){
    let text = highlightBox.innerHTML;
    let lines = text.split("\n");

    if(lines.length <= 20){
        return; // no read more needed
    }

    let visible = lines.slice(0,20).join("\n");
    let hidden = lines.slice(20).join("\n");

    highlightBox.innerHTML = visible + 
        `\n<div class='readmore-btn' onclick='showMore()'>Read more...</div>
         <span id='hiddenPart' style='display:none;'>${hidden}</span>`;
}

function showMore(){
    document.getElementById("hiddenPart").style.display = "inline";
    document.querySelector(".readmore-btn").remove();
}

/* ---------- DOWNLOAD ---------- */
function downloadCode(){
    let code = editor.value;
    let blob = new Blob([code], {type:"text/plain"});
    let a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "code.html";
    a.click();
}

/* ---------- FULL SCREEN ---------- */
function openFullScreen(){
    localStorage.setItem("fullScreenCode", editor.value);
    window.location.href = "full_screen.html";
}

/* ---------- MENU ---------- */
function openMenu(){
    alert("Menu system will be added...");
}
</script>

</body>
</html>
